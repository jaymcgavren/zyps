#!/usr/bin/ruby

begin
	require 'zyps'
	require 'zyps/views/trails'
rescue LoadError
	require 'rubygems'
	require 'zyps'
	require 'zyps/views/trails'
end


begin

	WIDTH = 400
	HEIGHT = 300

	#Create a window, and set GTK up to quit when it is closed.
	window = Gtk::Window.new
	window.signal_connect("delete_event") {false}
	window.signal_connect("destroy") {Gtk.main_quit}
	
	#Add view to window.
	view = TrailsView.new(WIDTH, HEIGHT)
	window.add(view.canvas)
	window.show_all
	
	#Create environment with objects.
	environment = Environment.new
	50.times do |i|
		multiplier = i / 50.to_f
		environment.objects << Creature.new(
			i,
			Location.new(multiplier * view.width, multiplier * view.height),
			Color.new(multiplier, 1 - multiplier, multiplier / 2 + 0.5),
			Vector.new(100 * multiplier, multiplier * 360)
		)
	end

	#Start animation thread.
	thread = Thread.new do
		begin
			loop do
				view.render(environment.objects)
				environment.interact
				sleep 1.0 / 60.0
			end
		rescue Exception => exception
			puts exception, exception.backtrace
		end
	end

	#Start GUI thread.
	Gtk.main

rescue => exception

	#Print error to STDERR and exit with an abnormal status.
	abort "Error: " + exception.message + exception.backtrace.join("\n")

end
